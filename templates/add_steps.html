<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Steps</title>

    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="app">
            {% raw %}
            <div v-for="step in steps">
                <h2>{{ step.type }}</h2>
                <div :id="'plot_' + step.id"></div>

                <form :action="'/add_steps/' + step.dataset_id" method="post">
                    <div class="form-group">
                        <select name="type" id="type" class="form-control">
                            <option v-for="step_type in step_types" :value="step_type">{{ step_type }}</option>
                        </select>
                        <input type="submit" value="Add Step" class="btn btn-primary">
                    </div>
                </form>
            </div>
            {% endraw %}
        </div>
    </div>

    <script>
        window.serverData = {
            steps: [{% for step in steps %}{ id: {{ step.id }}, type: "{{ step.type }}", dataset_id: "{{ dataset_id }}" }{% if not loop.last %}, {% endif %}{% endfor %}],
            step_types: [{% for step_type in step_types %}"{{ step_type }}"{% if not loop.last %}, {% endif %}{% endfor %}]
        };

        new Vue({
            el: '#app',
            data: {
                steps: window.serverData.steps,
                step_types: window.serverData.step_types
            }
        });

        $(document).ready(function() {
            const steps = window.serverData.steps;

            function loadPlot(stepIndex) {
                if (stepIndex >= steps.length) {
                    return;
                }

                const stepId = steps[stepIndex].id;
                $.ajax({
                    url: '/get_plot/' + stepId,
                    type: 'GET',
                    success: function(response) {
                        $('#plot_' + stepId).html(response);
                        loadPlot(stepIndex + 1);
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            }

            loadPlot(0);
        });
    </script>
</body>
</html>
